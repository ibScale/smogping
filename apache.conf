# SmogPing Web Dashboard Apache Configuration
# This file should be placed in /etc/apache2/conf-available/ or /etc/httpd/conf.d/ or /etc/apache2/conf.d/
# depending on your Apache distribution

# Alias for SmogPing webapp
Alias /smogping /usr/share/smogping/webapp

# Directory configuration for SmogPing webapp
<Directory "/usr/share/smogping/webapp">
    # Allow access from all clients
    Require all granted
    
    # Enable PHP processing
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
    </FilesMatch>
    
    # Security settings
    Options -Indexes -MultiViews +FollowSymLinks
    AllowOverride None
    
    # Prevent access to sensitive files
    <FilesMatch "\.(toml|conf|log|bak|orig|tmp)$">
        Require all denied
    </FilesMatch>
    
    # Prevent access to config files
    <Files "config.php">
        Require all denied
    </Files>
    
    <Files "config.example.php">
        Require all granted
    </Files>
    
    # Set proper MIME types
    <IfModule mod_mime.c>
        AddType application/json .json
        AddType text/css .css
        AddType application/javascript .js
    </IfModule>
    
    # Enable compression for better performance
    <IfModule mod_deflate.c>
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </IfModule>
    
    # Set cache headers for static assets
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/jpg "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/ico "access plus 1 month"
    </IfModule>
</Directory>

# Additional security headers
<IfModule mod_headers.c>
    <Location "/smogping">
        # Prevent clickjacking
        Header always append X-Frame-Options SAMEORIGIN
        
        # Prevent MIME type sniffing
        Header always set X-Content-Type-Options nosniff
        
        # Enable XSS protection
        Header always set X-XSS-Protection "1; mode=block"
        
        # Referrer policy
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </Location>
</IfModule>

# Optional: Redirect root to SmogPing dashboard
# Uncomment the following lines if you want / to redirect to /smogping
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteRule ^/?$ /smogping/ [R=301,L]
# </IfModule>
